//$("#ajax-status").append('<br>Progress: <%= @all_progresses.to_s %>')

<% 
#puts @all_progresses[:item]

p = @all_progresses[:item]
p = [ p ] unless p.kind_of?(Array)

#puts p.to_json  
%>

tasks = <%= raw(p.to_json) %>

function updateProgresses(task) {

  if (task.progress == '100') {
    
    $(pbSel).progressbar({value: 100})
    delete taskIds[parseInt(task.id)]

    $.ajax({
      url: '/testcase/ajax/get-result',
      data: { taskId: task.id }
    })

  } else {

    var pbSel = "#progressbar-" + task.id
    $(pbSel).progressbar({value: parseInt(task.progress) * 10})   
    $(pbSel + ' .ui-progressbar-value').css({"transition": "width 0.5s", "-webkit-transition": "width 0.5s"})
  
  }
}

for (var i = 0; i < tasks.length; i++)
  updateProgresses(tasks[i])

