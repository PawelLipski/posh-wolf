
<%= @text %> <br/>

<h1>SOAP responses: </h1> <br> 
<%= @soap_resps.each do |resp| %> 
<%= resp =%> <br/> <br/>
<% end %>

<h1> Collection names: </h1> <br>
<% @coll_names.each do |coll_name| %>
  <%= coll_name %> <br/>
<% end %>

<%= form_tag("/testcase/new", method: "post") do %>
  <%= label_tag(:url, "Test case URL::") %>
  <%= text_field_tag(:url) %>
  <%= text_field_tag(:name) %>
  <%= submit_tag("Submit") %>
<% end %>

<!-- TODO: CSRF? -->
<%= link_to "Init task", "/testcase/ajax/init-task", method: :post, remote: true, id: :init_task_link %>

<%= form_tag("/testcase/async", remote: true, format: :js, method: :get) do %>
  <!-- <input type="hidden" name="format" value="js"/> -->
  <%= submit_tag "Test AJAX (state = off)", id: "ajax-button" %>
<% end %>

<span id="ajax-status">(AJAX status)</span>


<script>
  /*
  $(document).ajaxSuccess(function() {
    $( "#ajax-status" ).text( "Triggered ajaxSuccess handler." );
  });*/



 /*$( document ).ajaxSuccess(function( event, xhr, settings ) {
   $( "#ajax-status" ).append( event + "<br>" + xhr.responseXML + "<br>" + xhr.responseText + "<br>" + settings.url );
   //$.ajax({url: "/testcase/async" })
 });*/

  $(document).on('ajax:success', '#init_task_link', function(e) {
      $( "#ajax-button" ).attr('value', "Task already initialized" )
      function check_progress() {
        $.ajax({
      	  url: "/testcase/ajax/get-progress", 
	  success: check_progress
	})
      }
      check_progress()
      /*$.ajax({
      	url: "/testcase/ajax/get-progress" //, 
	success: function(dataCheck) { 		
          $( "#ajax-status" ).append( "<br><b>"+ dataCheck + "</b>" );
	} 
      })*/
  });

</script>

