

<table id="launch-table" width="100%">
  <tr style="border-bottom: 1px solid lightgray">
    <td rowspan="4" width="40%" valign="top" style="border-right: 1px solid lightgray">
      <div style="float: left"> 
	<font color="gray"><h4> Use sample test cases </h4></font>
      </div>
    </td>    
    <td valign="top">
      <div style="float: left"> 
	<font color="gray"><h4> Paste test case URL </h4></font>
      </div>
    </td>
  </tr>
  
  <tr>
    <td style="padding-top: 10px; padding-left: 10px">
      <input id="input-url" value="http://mistic.heig-vd.ch/taillard/problemes.dir/ordonnancement.dir/flowshop.dir/tai20_5.txt"/>
    </td>
  </tr>
  
  <tr>
    <!-- <td valign="top" style="border-right: 1px solid lightgray">
      Sample data from Taillard's collection (TODO link) 
    </td> -->
    <td valign="top">
      <div style="float: left"> 
	<font color="gray"><h4> Paste test case contents </h4></font>
      </div>
    </td>
  </tr>
  
  <tr>    
    <td style="padding-top: 10px; padding-left: 10px">
      <textarea></textarea>
    </td>
  </tr>
</table>


<table id="task-table" width="100%">
  <tbody>
  </tbody>
</table>  



<button id="init-task-button" class="btn btn-large btn-primary">Init task</button>
<button id="init-large-task-button" class="btn btn-large btn-primary">Init large task</button>
<button id="init-task-from-url-button" class="btn btn-large btn-primary">Init task from the above URL</button>

<%= form_tag({action: :upload}, multipart: true) do %>
  <%= file_field_tag 'new_task', id: 'upload-input' %>  
<% end %>

<button id="upload-button">Upload</button>


<script>

progressCheckRunning = false
initTaskLocked = false
taskIds = {}

ongoingAnimationId = 0

function get_progress() {
  if (Object.keys(taskIds).length == 0) 
    progressCheckRunning = false
  else  
    $.ajax({
      url: "/testcase/ajax/get-all-progresses", 
      data: { "taskIds": Object.keys(taskIds) },
      success: get_progress
    })
}      

$(document).ready(function() {
  $("#upload-button").click(function() {      
    file = $('#upload-input').files[0];
    fr = new FileReader();
    fr.onload = function () {
      alert(fr.result)
    }        
    fr.readAsDataURL(file);         
  })            
               
  $("#init-task-button").click(
    function() {
      
      if (initTaskLocked) return

      initTaskLocked = true

      $.ajax({
	url: "/testcase/ajax/post-task",
	type: "POST",
	contentType: "application/soap+xml; charset=utf-8",
	success: function() {
	  initTaskLocked = false

	  if (!progressCheckRunning) {
	    progressCheckRunning = true
	    get_progress()
	  }
      }
    })

  })
  
  $("#init-large-task-button").click(
    function() {
      
      if (initTaskLocked) return

      initTaskLocked = true

      $.ajax({
	url: "/testcase/ajax/post-large-task",
	type: "POST",
	contentType: "application/soap+xml; charset=utf-8",
	success: function() {
	  initTaskLocked = false

	  if (!progressCheckRunning) {
	    progressCheckRunning = true
	    get_progress()
	  }
      }
    })

  })
  
  $("#init-task-from-url-button").click(
    function() {
      
      if (initTaskLocked) return
      
      var srcUrl = $("#input-url").val()      
      if (srcUrl.match(/^\s*$/)) return // whitespace-only

      initTaskLocked = true

      $.ajax({
	url: "/testcase/ajax/post-task-from-url",
	type: "POST",	
	data: { srcUrl: srcUrl },
	
	complete: function() {
	  initTaskLocked = false
	},
	
	error: function(XMLHttpRequest, textStatus, errorThrown) {
	  $("<div>The specified URL does not point to a valid Flow Shop test case data!</div>").appendTo("#task-list-container")
	    .dialog({ 
	      title: "Error",
	      buttons: [ 
		{ text: "Ok", click: function() { $(this).dialog("close"); } } 
	      ]
	    })
	    $(".ui-dialog-titlebar-close").css({ display: "none" })
	},
	
	success: function() {	  
	  if (!progressCheckRunning) {
	    progressCheckRunning = true
	    get_progress()
	  }
	}
      })

   })  
})
</script>

