

pbSel = "#progressbar-" + <%= params[:taskId] %>

$(pbSel).hide(1000, function() {      
                                
  var taskId = <%= params[:taskId] %>
  var hdrTrSel = "#task-hdr-tr-" + taskId
  var hdrTdSel = "#task-hdr-td-" + taskId
  var detTrSel = ".task-det-tr-" + taskId
  var animBtnId = "task-anim-btn-" + taskId
  <% animLoaderGifId = "task-anim-ldrgif-" + params[:taskId] %>
  var animLoaderGifId = "<%= raw(animLoaderGifId) %>"
  var animBtnContnrId = "task-anim-btn-contnr-" + taskId
  var ctimeSel = "#ctime-label-" + taskId
  var ratioSel = "#ratio-label-" + taskId

  $(hdrTdSel).html('<b>Execution timespan: ' + <%= @result[:execution_timespan] %> + '</b>' +
    '<span id="' + animBtnContnrId + '">' + 
    '<%= image_tag "ajax-loader.gif", id: animLoaderGifId, style: "float: right; display: none" %>' +
    '<button id="' + animBtnId + '" class="btn btn-large btn-primary" style="float: right">Visualize</button>' +    
    '</span>')
                               
  $(ctimeSel).html('<%= "%.2f" % @result[:computation_time] %>s')
  
  var upperBound = parseInt($(ratioSel).text())
  $(ratioSel).html(Math.round((((<%= raw(@result[:execution_timespan]) %>) - upperBound) / upperBound) * 100) + '%')
                   
  $(detTrSel).show(1000)

  var animBtnContnr = $("#" + animBtnContnrId)
  var animBtn =  $("#" + animBtnId)  
  var animLoaderGif = $("#" + animLoaderGifId)
                               
  animBtn.click(function() { 

    animBtn.css({ visibility: 'hidden' })
    animLoaderGif.show()    

    $.ajax({
      url: '/ajax/load-animation',
      data: { taskId: taskId },
      success: function() {
        animLoaderGif.css({ visibility: 'hidden' })
      }
    })
  })

})

